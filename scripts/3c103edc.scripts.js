!function(){var a=angular.module("adaptive.speech",[]);a.value("DEST_LANG","en-US"),a.factory("$speechRecognition",["$rootScope","DEST_LANG",function(a,b){var c=function(){this.start=function(){this.onerror({code:0,error:"speech recognition is not supported"})}.bind(this),this.stop=function(){this.onerror({code:0,error:"speech recognition is not supported"})}.bind(this)};window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition||c;var d,e=function(){d=new window.SpeechRecognition,d.continuous=!0,d.interimResults=!0,d.maxAlternatives=3,d.onresult=function(a){p&&p(a)},d.onstart=function(a){console.log("listening..."),f&&f(a)},d.onend=function(a){o&&o(a)},d.onerror=function(a){console.log(a),g&&g(a)}};e();var f,g,h=!1,i=!1,j=!1,k=function(a){if(!a)return!1;var c=["http://www.corsproxy.com/","translate.google.com/translate_tts?ie=UTF-8&q=",a,"&tl=",b].join(""),d=new Audio;d.addEventListener("play",function(){console.log("isSpeaking start")},!1),d.addEventListener("ended",function(){j=!0,console.log("isSpeaking end")},!1),d.addEventListener("error",function(){console.log("error"),console.log("isSpeaking end")},!1),d.autoplay=!0,d.src=c},l=function(){i||(e(),d.start(),console.log(d)),i=!0},m=function(){i&&(d.stop(),console.log(d)),i=!1},n=function(a){b=a,d.lang=a},o=function(){h=!1,d=null},p=function(c){if(c.results.length){var d=c.results[c.resultIndex];if(d.isFinal){if(j)return j=!1,!1;var e=d[0].transcript.trim();h&&(console.log(d),console.log('utterance: "'+e+'"'),a.$broadcast("adaptive.speech:utterance",{lang:b,utterance:e}))}}},q=function(c){return a.$on("adaptive.speech:utterance",function(a,d){var e=[];angular.isArray(c)?e=c:e.push(c),e.forEach(function(a){if(console.log(d),console.log(a),a.lang!==b)return!1;var c=a.regex||null,e=d.utterance;console.log(c,e.match(c)),e.match(c)&&a.call(e)})})};return{onstart:function(a){f=a},onerror:function(a){g=a},setLang:function(a){n(a)},getLang:function(){return b},speak:function(a){k(a)},payAttention:function(){h=!0},ignore:function(){h=!1},listen:function(){l()},stopListening:function(){m()},listenUtterance:function(a){return q(a)}}}]),a.directive("speechrecognition",["$rootScope","DEST_LANG",function(a,b){return{restrict:"A",link:function(c,d,e){var f=function(){return angular.extend({},c.$eval(e.speechrecognition))},g=f();console.log(g),a.$on("adaptive.speech:utterance",function(a,c){var d=[];angular.isArray(g.tasks)?d=g.tasks:d.push(g.tasks),console.log(c),d.forEach(function(a){if(a.lang!==b)return!1;var d=a.regex||null,e=c.utterance;e.match(d)&&e.match(new RegExp(g.thing,"ig"))&&(console.log(d,e.match(d),e.match(new RegExp(g.thing,"ig"))),a.call(e))})})}}}])}(),function(){"use strict";angular.module("UniversityChallengeApp",["ngRoute","mongolab","adaptive.speech"]).config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html"}).when("/teams",{templateUrl:"views/teams.html",controller:"TeamListCtrl"}).when("/teams/new",{templateUrl:"views/edit.html",controller:"TeamCreateCtrl"}).when("/teams/edit/:id",{templateUrl:"views/edit.html",controller:"TeamEditCtrl"}).when("/games",{templateUrl:"views/games.html",controller:"GameListCtrl"}).when("/games/new",{templateUrl:"views/startgame.html",controller:"GameCreateCtrl"}).when("/games/play/:id",{templateUrl:"views/playgame.html",controller:"GamePlayCtrl"}).otherwise({redirectTo:"/"})}])}.call(this),function(){"use strict";var a;a=function(a,b){var c,d;return d="https://api.mongolab.com/api/1/databases/uni-challenge/collections",c=b(""+d+"/"+a+"/:id",{apiKey:"h18zCyIluqeZTTcASk1tJBv-zOfNGgFi"},{update:{method:"PUT"}}),c.prototype.update=function(a){return c.update({id:this._id.$oid},angular.extend({},this,{_id:void 0}),a)},c.prototype.destroy=function(a){return c.remove({id:this._id.$oid},a)},c},angular.module("mongolab",["ngResource"]).factory("Team",["$resource",function(b){return a("teams",b)}]).factory("Game",["$resource",function(b){return a("games",b)}])}.call(this),function(){"use strict";angular.module("UniversityChallengeApp").directive("team",function(){return{replace:!0,restrict:"E",scope:{countdown:"=",editable:"=",score:"=",team:"="},templateUrl:"views/team.html"}})}.call(this),function(){"use strict";angular.module("UniversityChallengeApp").controller("TeamListCtrl",["$scope","Team",function(a,b){return a.teams=b.query()}]).controller("TeamCreateCtrl",["$scope","$location","Team",function(a,b,c){return a.save=function(){return c.save(a.team,function(){return b.path("/teams")})}}]).controller("TeamEditCtrl",["$scope","$location","$routeParams","Team",function(a,b,c,d){var e=this;return d.get({id:c.id},function(b){return e.original=b,a.team=new d(e.original)}),a.isClean=function(){return angular.equals(e.original,a.team)},a.destroy=function(){return e.original.destroy(function(){return b.path("/teams")})},a.save=function(){return a.team.update(function(){return b.path("/teams")})}}]).controller("GameListCtrl",["$scope","Team","Game",function(a,b,c){return a.games=c.query(),a.loadTeam=function(a){return console.log("Get Team",a),b.get({id:a},function(a){return a})},a.destroy=function(b){return b.destroy(function(){return a.games.splice(a.games.indexOf(b),1)})}}]).controller("GameCreateCtrl",["$scope","$location","Team","Game",function(a,b,c,d){return a.teams=c.query(),a.game={timeout:10,score1:0,score2:0},a.save=function(a){return a.timeout*=6e4,d.save(JSON.stringify(a),function(a){return b.path("/games/play/"+a._id.$oid)})}}]).controller("GamePlayCtrl",["$scope","$location","$routeParams","$timeout","$speechRecognition","Team","Game",function(a,b,c,d,e,f,g){var h,i,j,k;return g.get({id:c.id},function(b){return a.game=b,a.timeout=b.timeout,f.get({id:a.game.team1},function(b){return a.team1=b}),f.get({id:a.game.team2},function(b){return a.team2=b})}),a.countdown=0,k=void 0,i=function(){return a.timeout-=1e3,a.countdown&&a.timeout>0?k=d(i,1e3):0===a.timeout?alert("Time is up!"):void 0},a.startTimer=function(){return a.countdown=1,k=d(i,1e3)},a.resetTimer=function(){return d.cancel(k),a.countdown=0,a.timeout=a.game.timeout},a.pauseTimer=function(){return d.cancel(k),a.countdown=0},j=function(b){return a.unlisten(),h(b.which-48)},a.listen=function(){return a.listening=1,addEventListener("keypress",j)},a.unlisten=function(){return a.listening=void 0,removeEventListener("keypress",j)},h=function(b){var c;return c=4>=b?a.team1:a.team2,b>4&&(b-=4),a.$apply(function(){return a.buzzedFirst=c["player"+b],e.speak(c.name+"! "+c["player"+b]+"!")})},a.clearBuzzed=function(){return a.buzzedFirst=void 0},a.$watchCollection("game",function(){return a.game.update()})}])}.call(this);