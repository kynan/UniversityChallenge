(function(){"use strict";angular.module("UniversityChallengeApp",["ngRoute","mongolab"]).config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html"}).when("/teams",{templateUrl:"views/teams.html",controller:"TeamListCtrl"}).when("/teams/new",{templateUrl:"views/edit.html",controller:"TeamCreateCtrl"}).when("/teams/edit/:id",{templateUrl:"views/edit.html",controller:"TeamEditCtrl"}).when("/games",{templateUrl:"views/games.html",controller:"GameListCtrl"}).when("/games/new",{templateUrl:"views/startgame.html",controller:"GameCreateCtrl"}).when("/games/play/:id",{templateUrl:"views/playgame.html",controller:"GamePlayCtrl"}).otherwise({redirectTo:"/"})}])}).call(this),function(){"use strict";var a;a=function(a,b){var c,d;return d="https://api.mongolab.com/api/1/databases/uni-challenge/collections",c=b(""+d+"/"+a+"/:id",{apiKey:"h18zCyIluqeZTTcASk1tJBv-zOfNGgFi"},{update:{method:"PUT"}}),c.prototype.update=function(a){return c.update({id:this._id.$oid},angular.extend({},this,{_id:void 0}),a)},c.prototype.destroy=function(a){return c.remove({id:this._id.$oid},a)},c},angular.module("mongolab",["ngResource"]).factory("Team",["$resource",function(b){return a("teams",b)}]).factory("Game",["$resource",function(b){return a("games",b)}])}.call(this),function(){"use strict";angular.module("UniversityChallengeApp").directive("team",function(){return{replace:!0,restrict:"E",scope:{countdown:"=",editable:"=",score:"=",team:"="},templateUrl:"views/team.html"}})}.call(this),function(){"use strict";angular.module("UniversityChallengeApp").controller("TeamListCtrl",["$scope","Team",function(a,b){return a.teams=b.query()}]).controller("TeamCreateCtrl",["$scope","$location","Team",function(a,b,c){return a.save=function(){return c.save(a.team,function(){return b.path("/teams")})}}]).controller("TeamEditCtrl",["$scope","$location","$routeParams","Team",function(a,b,c,d){var e=this;return d.get({id:c.id},function(b){return e.original=b,a.team=new d(e.original)}),a.isClean=function(){return angular.equals(e.original,a.team)},a.destroy=function(){return e.original.destroy(function(){return b.path("/teams")})},a.save=function(){return a.team.update(function(){return b.path("/teams")})}}]).controller("GameListCtrl",["$scope","Team","Game",function(a,b,c){return a.games=c.query(),a.loadTeam=function(a){return console.log("Get Team",a),b.get({id:a},function(a){return a})},a.destroy=function(b){return b.destroy(function(){return a.games.splice(a.games.indexOf(b),1)})}}]).controller("GameCreateCtrl",["$scope","$location","Team","Game",function(a,b,c,d){return a.teams=c.query(),a.game={timeout:10,score1:0,score2:0},a.save=function(a){return a.timeout*=6e4,d.save(JSON.stringify(a),function(a){return b.path("/games/play/"+a._id.$oid)})}}]).controller("GamePlayCtrl",["$scope","$location","$routeParams","$timeout","Team","Game",function(a,b,c,d,e,f){var g,h,i,j,k,l;return f.get({id:c.id},function(b){return a.game=b,a.timeout=b.timeout,e.get({id:a.game.team1},function(b){return a.team1=b}),e.get({id:a.game.team2},function(b){return a.team2=b})}),Pusher.logToConsole=!0,k=new Pusher("cba436e88472fa7154a2",{cluster:"eu",encrypted:!0}),h=k.subscribe("gameshow"),h.bind("button",function(b){var c;return a.listening?(a.unlisten(),c="1"===b.id?a.team1:a.team2,a.$apply(function(){var b;return a.buzzedFirst=c.name,null!=(b=window.speechSynthesis)?b.speak(new SpeechSynthesisUtterance(c.name+"!")):void 0})):void 0}),a.countdown=0,l=void 0,i=function(){return a.timeout-=1e3,a.countdown&&a.timeout>0?l=d(i,1e3):0===a.timeout?alert("Time is up!"):void 0},a.startTimer=function(){return a.countdown=1,l=d(i,1e3)},a.resetTimer=function(){return d.cancel(l),a.countdown=0,a.timeout=a.game.timeout},a.pauseTimer=function(){return d.cancel(l),a.countdown=0},j=function(b){return a.unlisten(),g(b.which-48)},a.listen=function(){return a.listening=1,addEventListener("keypress",j)},a.unlisten=function(){return a.listening=void 0,removeEventListener("keypress",j)},g=function(b){var c;return c=4>=b?a.team1:a.team2,b>4&&(b-=4),a.$apply(function(){var d;return a.buzzedFirst=c["player"+b],null!=(d=window.speechSynthesis)?d.speak(new SpeechSynthesisUtterance(c.name+"! "+c["player"+b]+"!")):void 0})},a.clearBuzzed=function(){return a.buzzedFirst=void 0},a.$watchCollection("game",function(){return a.game.update()})}])}.call(this);